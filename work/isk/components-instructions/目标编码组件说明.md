## 目标编码

### 1. 简介

对于定类变量，目标编码（Target Encoding/ Mean Encoding）基于目标变量的先验和后验概率进行加权；对于连续变量，目标编码基于目标变量的期望进行加权。

### 2. 参数面板说明

+ 编码列：需要进行目标编码的列，可多选，应为定类变量。

+ 标签列：目标变量，应为数值型变量。
+ 类别最小样本数：若属于该类别的样本小于这一阈值，将不纳入总体的概率/期望的计算。默认为1。
+ 平滑系数：平滑系数越大，正则化强度越大。应为正浮点数，默认为1.0。

### 3. 输入输出桩说明

+ 输入桩：1个，连接数据对象。
+ 输出桩：1个，返回数据对象。

### 4. 节点报告

+ 返回已目标编码的数据对象，列名为 编码列_标签列。

![Target Encoding](D:\文档\2020-2021-2\文本分析组件\pics\TargetEncodingReport.png)

### 5. 原理说明

+ 先验估计为全体样本中，目标变量 $y$ 的均值 $\bar y$
+ 后验估计为属于某类别 $i$ 的样本中，目标变量 $ y$  的均值 $ \bar y_i$
+ 平滑权重 $\lambda $=$\frac{1}{1+e^{- \frac {samples-minsamples}{smoothing}}}$ , 其中 $samples$ 表示定类变量中某类别的样本数，$minsamples$ 表示类别最小样本数，$smoothing$ 表示平滑系数

+ 属于类别 $i$  的样本的目标编码结果为 $ (1 - \lambda) \times \bar y  + \lambda \times \bar y_i$ 

